<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>修改表字段类型后旧分区字段不更新类型 | zxk&#39;s book</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="兴趣使然的备忘库">
    <link rel="preload" href="/books/assets/css/0.styles.50f3151d.css" as="style"><link rel="preload" href="/books/assets/js/app.f49d838e.js" as="script"><link rel="preload" href="/books/assets/js/2.3809c37a.js" as="script"><link rel="preload" href="/books/assets/js/22.d111a3c4.js" as="script"><link rel="prefetch" href="/books/assets/js/10.173e6f22.js"><link rel="prefetch" href="/books/assets/js/100.93149a22.js"><link rel="prefetch" href="/books/assets/js/101.4bb37a49.js"><link rel="prefetch" href="/books/assets/js/102.908f675f.js"><link rel="prefetch" href="/books/assets/js/103.b470edcb.js"><link rel="prefetch" href="/books/assets/js/104.0d96599f.js"><link rel="prefetch" href="/books/assets/js/105.46356f60.js"><link rel="prefetch" href="/books/assets/js/106.2859c731.js"><link rel="prefetch" href="/books/assets/js/107.e035252f.js"><link rel="prefetch" href="/books/assets/js/11.95675098.js"><link rel="prefetch" href="/books/assets/js/12.4f9309cc.js"><link rel="prefetch" href="/books/assets/js/13.b08c71ed.js"><link rel="prefetch" href="/books/assets/js/14.21b5c4e6.js"><link rel="prefetch" href="/books/assets/js/15.cdb568da.js"><link rel="prefetch" href="/books/assets/js/16.1f61bacf.js"><link rel="prefetch" href="/books/assets/js/17.f92c956c.js"><link rel="prefetch" href="/books/assets/js/18.80fb975c.js"><link rel="prefetch" href="/books/assets/js/19.c14ed473.js"><link rel="prefetch" href="/books/assets/js/20.3b61c71f.js"><link rel="prefetch" href="/books/assets/js/21.1d0eda6f.js"><link rel="prefetch" href="/books/assets/js/23.2319e04b.js"><link rel="prefetch" href="/books/assets/js/24.fab9dc05.js"><link rel="prefetch" href="/books/assets/js/25.f48e0e3f.js"><link rel="prefetch" href="/books/assets/js/26.c7efb2c3.js"><link rel="prefetch" href="/books/assets/js/27.a9e03a40.js"><link rel="prefetch" href="/books/assets/js/28.a01a8c75.js"><link rel="prefetch" href="/books/assets/js/29.8761f141.js"><link rel="prefetch" href="/books/assets/js/3.5c52f258.js"><link rel="prefetch" href="/books/assets/js/30.e774d6db.js"><link rel="prefetch" href="/books/assets/js/31.6f4bffc0.js"><link rel="prefetch" href="/books/assets/js/32.1f62d60b.js"><link rel="prefetch" href="/books/assets/js/33.c7aea22b.js"><link rel="prefetch" href="/books/assets/js/34.01929a45.js"><link rel="prefetch" href="/books/assets/js/35.0fe51d37.js"><link rel="prefetch" href="/books/assets/js/36.957aba7b.js"><link rel="prefetch" href="/books/assets/js/37.9e255472.js"><link rel="prefetch" href="/books/assets/js/38.23731932.js"><link rel="prefetch" href="/books/assets/js/39.4005f83b.js"><link rel="prefetch" href="/books/assets/js/4.4e6e6a80.js"><link rel="prefetch" href="/books/assets/js/40.47ddf780.js"><link rel="prefetch" href="/books/assets/js/41.ffb6939e.js"><link rel="prefetch" href="/books/assets/js/42.c736916b.js"><link rel="prefetch" href="/books/assets/js/43.649267b4.js"><link rel="prefetch" href="/books/assets/js/44.604b76cd.js"><link rel="prefetch" href="/books/assets/js/45.5c045c1f.js"><link rel="prefetch" href="/books/assets/js/46.9a006676.js"><link rel="prefetch" href="/books/assets/js/47.eacd6a46.js"><link rel="prefetch" href="/books/assets/js/48.d675b621.js"><link rel="prefetch" href="/books/assets/js/49.d629c51a.js"><link rel="prefetch" href="/books/assets/js/5.714c3f84.js"><link rel="prefetch" href="/books/assets/js/50.86dfdbd8.js"><link rel="prefetch" href="/books/assets/js/51.a34aa91a.js"><link rel="prefetch" href="/books/assets/js/52.d58c2607.js"><link rel="prefetch" href="/books/assets/js/53.cf1a7467.js"><link rel="prefetch" href="/books/assets/js/54.8b5c039b.js"><link rel="prefetch" href="/books/assets/js/55.8996992c.js"><link rel="prefetch" href="/books/assets/js/56.5c37b9d7.js"><link rel="prefetch" href="/books/assets/js/57.2dcf7224.js"><link rel="prefetch" href="/books/assets/js/58.752334c2.js"><link rel="prefetch" href="/books/assets/js/59.50ef5988.js"><link rel="prefetch" href="/books/assets/js/6.37036b9d.js"><link rel="prefetch" href="/books/assets/js/60.49c8ae18.js"><link rel="prefetch" href="/books/assets/js/61.82bfc8f5.js"><link rel="prefetch" href="/books/assets/js/62.e2684aca.js"><link rel="prefetch" href="/books/assets/js/63.ba81314a.js"><link rel="prefetch" href="/books/assets/js/64.4a9e1f94.js"><link rel="prefetch" href="/books/assets/js/65.80f33626.js"><link rel="prefetch" href="/books/assets/js/66.c2a44e6c.js"><link rel="prefetch" href="/books/assets/js/67.612f6ed4.js"><link rel="prefetch" href="/books/assets/js/68.e8d5bee8.js"><link rel="prefetch" href="/books/assets/js/69.73801a44.js"><link rel="prefetch" href="/books/assets/js/7.f89c49dc.js"><link rel="prefetch" href="/books/assets/js/70.dec2f1de.js"><link rel="prefetch" href="/books/assets/js/71.a3208f56.js"><link rel="prefetch" href="/books/assets/js/72.7460a44c.js"><link rel="prefetch" href="/books/assets/js/73.1bb45c74.js"><link rel="prefetch" href="/books/assets/js/74.8f0aaef8.js"><link rel="prefetch" href="/books/assets/js/75.d6798103.js"><link rel="prefetch" href="/books/assets/js/76.617f9599.js"><link rel="prefetch" href="/books/assets/js/77.1580edd0.js"><link rel="prefetch" href="/books/assets/js/78.6bd19f58.js"><link rel="prefetch" href="/books/assets/js/79.787f9e2a.js"><link rel="prefetch" href="/books/assets/js/8.d4e84bb7.js"><link rel="prefetch" href="/books/assets/js/80.a3d78ca7.js"><link rel="prefetch" href="/books/assets/js/81.5d50eeb4.js"><link rel="prefetch" href="/books/assets/js/82.2b8ed68b.js"><link rel="prefetch" href="/books/assets/js/83.0ce7a910.js"><link rel="prefetch" href="/books/assets/js/84.0d881df0.js"><link rel="prefetch" href="/books/assets/js/85.2f8767ef.js"><link rel="prefetch" href="/books/assets/js/86.710b8f60.js"><link rel="prefetch" href="/books/assets/js/87.5adfe8bf.js"><link rel="prefetch" href="/books/assets/js/88.11bbc9c5.js"><link rel="prefetch" href="/books/assets/js/89.9c9af733.js"><link rel="prefetch" href="/books/assets/js/9.57493b19.js"><link rel="prefetch" href="/books/assets/js/90.b214aa26.js"><link rel="prefetch" href="/books/assets/js/91.4d8f5e69.js"><link rel="prefetch" href="/books/assets/js/92.4acf0897.js"><link rel="prefetch" href="/books/assets/js/93.d04fb839.js"><link rel="prefetch" href="/books/assets/js/94.25880506.js"><link rel="prefetch" href="/books/assets/js/95.354b10df.js"><link rel="prefetch" href="/books/assets/js/96.cd05ef30.js"><link rel="prefetch" href="/books/assets/js/97.180a5a94.js"><link rel="prefetch" href="/books/assets/js/98.88a70f24.js"><link rel="prefetch" href="/books/assets/js/99.d52ebb90.js">
    <link rel="stylesheet" href="/books/assets/css/0.styles.50f3151d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/books/" class="home-link router-link-active"><img src="/books/Avatar.jpg" alt="zxk's book" class="logo"> <span class="site-name can-hide">zxk's book</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/books/nav.01.big-data/" class="nav-link">
  Big Data
</a></div><div class="nav-item"><a href="/books/nav.02.linux/" class="nav-link">
  Linux
</a></div><div class="nav-item"><a href="/books/nav.03.program-language/" class="nav-link">
  Program Language
</a></div><div class="nav-item"><a href="/books/nav.04.algorithm/" class="nav-link">
  Algorithm
</a></div><div class="nav-item"><a href="/books/nav.05.design-pattern/" class="nav-link">
  Design Pattern
</a></div><div class="nav-item"><a href="/books/nav.06.database/" class="nav-link">
  Database
</a></div><div class="nav-item"><a href="/books/nav.07.software/" class="nav-link">
  Software
</a></div><div class="nav-item"><a href="/books/" class="nav-link">
  Home
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/books/nav.01.big-data/" class="nav-link">
  Big Data
</a></div><div class="nav-item"><a href="/books/nav.02.linux/" class="nav-link">
  Linux
</a></div><div class="nav-item"><a href="/books/nav.03.program-language/" class="nav-link">
  Program Language
</a></div><div class="nav-item"><a href="/books/nav.04.algorithm/" class="nav-link">
  Algorithm
</a></div><div class="nav-item"><a href="/books/nav.05.design-pattern/" class="nav-link">
  Design Pattern
</a></div><div class="nav-item"><a href="/books/nav.06.database/" class="nav-link">
  Database
</a></div><div class="nav-item"><a href="/books/nav.07.software/" class="nav-link">
  Software
</a></div><div class="nav-item"><a href="/books/" class="nav-link">
  Home
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Spark</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Kafka</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Hadoop</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Hive</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/books/2020/07/21/_01-%E4%BF%AE%E6%94%B9%E8%A1%A8%E5%AD%97%E6%AE%B5%E7%B1%BB%E5%9E%8B%E5%90%8E%E6%97%A7%E5%88%86%E5%8C%BA%E5%AD%97%E6%AE%B5%E4%B8%8D%E6%9B%B4%E6%96%B0%E7%B1%BB%E5%9E%8B/" aria-current="page" class="active sidebar-link">修改表字段类型后旧分区字段不更新类型</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="修改表字段类型后旧分区字段不更新类型"><a href="#修改表字段类型后旧分区字段不更新类型" class="header-anchor">#</a> 修改表字段类型后旧分区字段不更新类型</h1> <p>Hive在修改、新增字段的时候，若表是分区表，那么做出的改动只对新分区生效，而旧分区无效，导致这个现象的原因是<strong>旧分区的metadata没有跟着修改</strong>。</p> <h3 id="_1-通过partition修改"><a href="#_1-通过partition修改" class="header-anchor">#</a> 1. 通过partition修改</h3> <p>从Hive0.14开始，修改、新增字段可以通过提供部分partition来进行批量修改，但要将<code>hive.exec.dynamic.partition</code>修改为true。</p> <p>一个一个partition修改：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> foo <span class="token keyword">PARTITION</span> <span class="token punctuation">(</span>ds<span class="token operator">=</span><span class="token string">'2008-04-08'</span><span class="token punctuation">,</span> hr<span class="token operator">=</span><span class="token number">11</span><span class="token punctuation">)</span> CHANGE <span class="token keyword">COLUMN</span> dec_column_name dec_column_name <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">38</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> foo <span class="token keyword">PARTITION</span> <span class="token punctuation">(</span>ds<span class="token operator">=</span><span class="token string">'2008-04-08'</span><span class="token punctuation">,</span> hr<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span> CHANGE <span class="token keyword">COLUMN</span> dec_column_name dec_column_name <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">38</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>提供部分partition批量修改：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">// hive.exec.dynamic.partition needs to be set to true to enable dynamic partitioning with ALTER PARTITION</span>
<span class="token keyword">SET</span> hive<span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">.</span>dynamic<span class="token punctuation">.</span><span class="token keyword">partition</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

<span class="token comment">// This will alter all existing partitions in the table with ds='2008-04-08' -- be sure you know what you are doing!</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> foo <span class="token keyword">PARTITION</span> <span class="token punctuation">(</span>ds<span class="token operator">=</span><span class="token string">'2008-04-08'</span><span class="token punctuation">,</span> hr<span class="token punctuation">)</span> CHANGE <span class="token keyword">COLUMN</span> dec_column_name dec_column_name <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">38</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// This will alter all existing partitions in the table -- be sure you know what you are doing!</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> foo <span class="token keyword">PARTITION</span> <span class="token punctuation">(</span>ds<span class="token punctuation">,</span> hr<span class="token punctuation">)</span> CHANGE <span class="token keyword">COLUMN</span> dec_column_name dec_column_name <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">38</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><blockquote><p>As of Hive 0.14 (HIVE-8411), users are able to provide a partial partition spec for certain above alter column statements, similar to dynamic partitioning. So rather than having to issue an alter column statement for each partition that needs to be changed.</p></blockquote> <h3 id="_2-通过cascade关键字更新"><a href="#_2-通过cascade关键字更新" class="header-anchor">#</a> 2. 通过CASCADE关键字更新</h3> <p>从Hive 1.1.0 开始，Hive允许通过关键字<code>CASCADE</code>以级联方式更改表以及<strong>所有分区</strong>的metadata：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> table_name CHANGE <span class="token punctuation">[</span><span class="token keyword">COLUMN</span><span class="token punctuation">]</span> col_old_name col_new_name column_type <span class="token punctuation">[</span><span class="token keyword">COMMENT</span> col_comment<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">FIRST</span><span class="token operator">|</span><span class="token keyword">AFTER</span> column_name<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">CASCADE</span><span class="token operator">|</span><span class="token keyword">RESTRICT</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>默认模式是<code>RESTRICT</code>，只修改表的元数据，<strong>不更新旧分区</strong>的metadata。</p> <p>官方文档：<a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DDL#LanguageManualDDL-PartialPartitionSpecification" target="_blank" rel="noopener noreferrer">LanguageManualDDL-PartialPartitionSpecification<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/books/assets/js/app.f49d838e.js" defer></script><script src="/books/assets/js/2.3809c37a.js" defer></script><script src="/books/assets/js/22.d111a3c4.js" defer></script>
  </body>
</html>
