<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- iOS Safari -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!-- Chrome, Firefox OS and Opera Status Bar Color -->
<meta name="theme-color" content="#FFFFFF">
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
<link rel="stylesheet" type="text/css"
  href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/themes/prism.min.css">
<link rel="stylesheet" type="text/css" href="css/SourceSansPro.css">
<link rel="stylesheet" type="text/css" href="css/theme.css">
<link rel="stylesheet" type="text/css" href="css/notablog.css">
<!-- Favicon -->

  <link rel="shortcut icon" href="https://avatars1.githubusercontent.com/u/32795735?s=400&amp;u=40ed0595fb3044b01c47849f59ad96d69b4dc8db&amp;v=4">

<style>
  :root {
    font-size: 20px;
  }
</style>
  <title>Idea+Maven+Git搭建Spark源码阅读环境&nbsp;|&nbsp;Rianico‘s Blog</title>
  <meta property="og:type" content="blog">
  <meta property="og:title" content="Idea+Maven+Git搭建Spark源码阅读环境">
  
    <meta name="description" content="本篇文章记录了 Idea 如何编译并阅读 Spark 源码的过程。">
    <meta property="og:description" content="本篇文章记录了 Idea 如何编译并阅读 Spark 源码的过程。">
  
  
    <meta property="og:image" content="https://raw.githubusercontent.com/Rianico/Image/master/Avator/sparkles%20(1).png">
  
  <style>
    .DateTagBar {
      margin-top: 1.0rem;
    }
  </style>
</head>

<body>
  <nav class="Navbar">
  <a href="index.html">
    <div class="Navbar__Btn">
      
        <span><img class="inline-img-icon" src="https://avatars1.githubusercontent.com/u/32795735?s=400&amp;u=40ed0595fb3044b01c47849f59ad96d69b4dc8db&amp;v=4"></span>&nbsp;
      
      <span>Home</span>
    </div>
  </a>
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <span class="Navbar__Delim">&centerdot;</span>
      <a href="about.html">
        <div class="Navbar__Btn">
          
            <span><img class="inline-img-icon" src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F88bfa795-fb50-42ad-b5f9-821f35ee821d%2Fgithub_(2).png?table=block&amp;id=457ca390-7a74-4a2f-9c26-1613b0d49d9c"></span>&nbsp;
          
          <span>About</span>
        </div>
      </a>
    
  
</nav>
  <header class="Header">
    
      <div class="Header__Cover">
        <img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Ff4a1a1f2-76f4-4731-bcc2-a4bf75534b7f%2Fphoto-1509910110001-4e756f86fbd3.jfif?table=block&amp;id=e4d8c0ab-dd38-4dd2-bd04-b798e89d08b9">
      </div>
    
    <div class="Header__Spacer ">
    </div>
    
      <div class="Header__Icon">
        <span><img class="inline-img-icon" src="https://raw.githubusercontent.com/Rianico/Image/master/Avator/sparkles%20(1).png"></span>
      </div>
    
    <h1 class="Header__Title">Idea+Maven+Git搭建Spark源码阅读环境</h1>
    
      <div class="DateTagBar">
        
          <span class="DateTagBar__Item DateTagBar__Date">Posted on Wed, Sep 11, 2019</span>
        
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--default">
            <a href="tag/Spark.html">Spark</a>
          </span>
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--brown">
            <a href="tag/Idea.html">Idea</a>
          </span>
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--blue">
            <a href="tag/Maven.html">Maven</a>
          </span>
        
      </div>
    
  </header>
  <article id="https://www.notion.so/e4d8c0abdd384dd2bd04b798e89d08b9" class="PageRoot PageRoot--FullWidth"><ul id="https://www.notion.so/66030cc7ae394953ba6492b365f1a0c1" class="ColorfulBlock ColorfulBlock--ColorGray TableOfContents"><li class="TableOfContents__Item"><a href="#https://www.notion.so/44822ba25bd04b479930b55f81e707cc"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">1. </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">环境准备</strong></span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/b8a90ba0cf264d68a990f57420d9f0cf"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">2. </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Git拉取Spark项目</strong></span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/b5be07482c5a4376ae7a533e001961f7"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">3. </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Idea导入Spark项目</strong></span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/15fec05e3b68493d821dd5b51b90c2b1"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">4. </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Idea编译过程遇到的一些问题</strong></span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/1e267afaca884959bfe1d744e828386b"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">4.</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">1 Error:(xx, xx) not found: type xxx</strong></span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/71a0ecd0c3b94f24b96a59145f670be4"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">4.</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">2 java.lang.NoClassDefFoundError: scala/Function1</strong></span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/c33b45bbc7ec4765b8e6c173bfa87886"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">4.</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">3 java.lang.NoClassDefFoundError: org/apache/spark/sql/SparkSession$</strong></span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/cd72f3314d5f473e9ef77956d4c0e9dd"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">4.</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">4 org.apache.spark.SparkException: Error while locating file spark-version-info.properties</strong></span></span></div></a></li></ul><h1 id="https://www.notion.so/44822ba25bd04b479930b55f81e707cc" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/44822ba25bd04b479930b55f81e707cc"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">1. </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">环境准备</strong></span></span></h1><div id="https://www.notion.so/069cd1c7fd164ae3a5400e07cebfb785" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">下面是我搭建环境时本地各组件的版本：</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/ced594d756d64025bec4054e00d0b2cb" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Idea：IntelliJ IDEA 2018.2.4 (Ultimate Edition)，请确保安装了 scala 插件</span></span></li><li id="https://www.notion.so/8082ead110ce4cfb8ac275fbb96feb6c" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">JDK：jdk1.8.0_181</span></span></li><li id="https://www.notion.so/c2215c92fa7b4d33b44cfca8524fb9e3" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Scala：2.11.8</span></span></li><li id="https://www.notion.so/5e9b848daca04d52988a4299afdd4c13" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Maven：apache-maven-3.5.4，</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">已配置阿里云国内镜像</strong></span><span class="SemanticString">。</span></span></li><li id="https://www.notion.so/478e4e33302c4015a811a4f3789305c7" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Git</span></span></li></ul><div id="https://www.notion.so/8c0b8657f85345338e5bf2821cc556ce" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">在开始编译 Spark 之前，最好先在 Maven 配置好国内镜像源，绝大部分问题都是由于仓库配置导致的。在 Meven 路径下 settings.xml 的 &lt;mirrors/&gt; 标签里添加如下内容：</span></span></p></div><pre id="https://www.notion.so/19c8eac257e74c409e4c65cea9c6702b" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mirror</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">></span></span>aliyun central<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mirrorOf</span><span class="token punctuation">></span></span>central<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mirrorOf</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>阿里云中央仓库<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">></span></span>https://maven.aliyun.com/repository/central<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mirror</span><span class="token punctuation">></span></span>

     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mirror</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">></span></span>aliyun apache snapshotsl<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mirrorOf</span><span class="token punctuation">></span></span>apache.snapshots<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mirrorOf</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>阿里云 apache snapshots 仓库<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">></span></span>https://maven.aliyun.com/repository/apache-snapshots<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mirror</span><span class="token punctuation">></span></span>

     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mirror</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">></span></span>aliyunmaven<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mirrorOf</span><span class="token punctuation">></span></span>public<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mirrorOf</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>阿里云public仓库<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">></span></span>https://maven.aliyun.com/repository/public<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mirror</span><span class="token punctuation">></span></span></span></span></span></code></pre><div id="https://www.notion.so/5d2a3be0adba43ad80b83814c5f3ed42" class="Divider"></div><h1 id="https://www.notion.so/b8a90ba0cf264d68a990f57420d9f0cf" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/b8a90ba0cf264d68a990f57420d9f0cf"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">2. </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Git拉取Spark项目</strong></span></span></h1><div id="https://www.notion.so/a9fdc143eb744b6094a90dc56b11373d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">首先使用Git拉取官方 Spark 项目，github 项目地址：</span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://github.com/apache/spark">https://github.com/apache/spark</a></span><span class="SemanticString"> 。</span></span></p></div><div id="https://www.notion.so/3dc2c32141e74a4dadbdb2c0c1507875" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">由于Spark项目很大，再加上服务器位于国外，所以拉取项目的过程会十分的慢，可能需要几个小时，这里提供一个节省时间的取巧方法：</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/2c224244ec234da081b767c8e32400ef" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">先将 Spark 项目 fork 到自己的 github 上</span></span></li><li id="https://www.notion.so/39315818e6e34fda827151dd8a809373" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">注册</span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://gitee.com/enterprises?invite_code=zhxuankun">码云</a></span><span class="SemanticString">，将其与 github 账号关联，登录码云</span></span></li><li id="https://www.notion.so/a39d68c8816e4146864f61638a6a00c7" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">登录后点击右上角 </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">+ </strong></span><span class="SemanticString">号，有个从 Github 导入仓库的选项，选择导入 Spark 项目</span></span></li><li id="https://www.notion.so/1c729803bb1b4f878486c03c6a076d29" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">等待一会（约十分钟），再查看码云上自己的 git 项目，可以发现已经导入到码云上了，接下来在码云上配置自己的ssh免密即可享受国内的下载速度了。</span></span></li></ul><div id="https://www.notion.so/e6bf777995674be4bcaa48c765e08eb8" class="Divider"></div><h1 id="https://www.notion.so/b5be07482c5a4376ae7a533e001961f7" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/b5be07482c5a4376ae7a533e001961f7"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">3. </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Idea导入Spark项目</strong></span></span></h1><div id="https://www.notion.so/5eb2689227d84a4aa450078fd757650d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">此处编译 Spark2.1.0 版本，首先将 Spark 顶层目录下 pom.xml 文件的 java 版本从 1.7 修改为 1.8。</span></span></p></div><pre id="https://www.notion.so/42f4d9a48d0346a2bb800990f4f97a8f" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span> <span class="token comment">&lt;!-- &lt;java.version>1.7&lt;/java.version> --></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>java.version</span><span class="token punctuation">></span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>java.version</span><span class="token punctuation">></span></span></span></span></span></code></pre><div id="https://www.notion.so/f38d5da986124dce94d0745072a0757d" class="ColumnList"><div id="https://www.notion.so/9def95699aaf46679fe0012990db7369" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><ol class="NumberedListWrapper"><li id="https://www.notion.so/b9a5ababfb5a46798cc1dfc2e2cdeffe" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">启动Idea，点击 </span><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">File -&gt; Import Project;</em></span></span></li><li id="https://www.notion.so/e0c2908899884aa0833908a84353afd2" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">选择 Spark 顶级目录下的 pom 文件，项目类型为 </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Maven Project</strong></span><span class="SemanticString">，推荐勾选 </span><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">Import Maven projects automatically;</em></span></span></li><li id="https://www.notion.so/4b7fff63c87245c4abc24caf2928620b" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString">修改 </span><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">Environment settings</em></span><span class="SemanticString">，修改 Maven 及其配置文件为本地的 Maven 配置，导入后 Idea 会自动编译，需要等待一段时间。</span></span></li></ol><div id="https://www.notion.so/69671e49f0324b9fa0d05aa8bd563217" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div></div><div id="https://www.notion.so/00f073fb61d94785a6cd466a9b508c46" class="Column" style="width:calc((100% - var(--column-spacing) * 1) * 0.5)"><div id="https://www.notion.so/0ab4869ac3f044658c5fb611b5b393ce" class="Image Image--Normal"><figure><a href="https://github.com/Rianico/Image/blob/master/ARTS_Tips/1567655224243.png?raw=true?width=624"><img src="https://github.com/Rianico/Image/blob/master/ARTS_Tips/1567655224243.png?raw=true?width=624" style="width:624px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div></div><div id="https://www.notion.so/0dfaaf1fe26745389f8217e865da9d6c" class="Divider"></div><h1 id="https://www.notion.so/15fec05e3b68493d821dd5b51b90c2b1" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/15fec05e3b68493d821dd5b51b90c2b1"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">4. </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Idea编译过程遇到的一些问题</strong></span></span></h1><div id="https://www.notion.so/a8e73f90b54a41e48e7f38b63f749260" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">Ctrl+Shift+N</em></span><span class="SemanticString"> 打开 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">LocalPi.scala</code></span><span class="SemanticString"> 并运行，接下来会出现很多问题，我们一个一个解决。</span></span></p></div><h2 id="https://www.notion.so/1e267afaca884959bfe1d744e828386b" class="ColorfulBlock ColorfulBlock--BgRed Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/1e267afaca884959bfe1d744e828386b"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">4.</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">1 Error:(xx, xx) not found: type xxx</strong></span></span></h2><pre id="https://www.notion.so/6332bf66ec7745fe814774183ec9c2f7" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span> Error:(45, 66) not found: type SparkFlumeProtocol
   val transactionTimeout: Int, val backOffInterval: Int) extends SparkFlumeProtocol with Logging {</span></span></span></code></pre><div id="https://www.notion.so/10bc679f5ad44f6bbda7db6aa801155b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">解决方法：点击 Idea 右侧的 </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Maven Projects</strong></span><span class="SemanticString">（如果找不到该窗口，则点击 Idea 上方导航 </span><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">Help-&gt;Find Action(Ctrl+Shift+A) ，</em></span><span class="SemanticString">输入 Maven projects），找到 </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Spark Project External Flume Sink</strong></span><span class="SemanticString">，右键点击 </span><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">Generate Sources and Update Folders</em></span><span class="SemanticString"> 即可，需要等待较长的一段时间（取决于电脑配置）。</span></span></p></div><div id="https://www.notion.so/cd780adb4a9c40b89b6ca6c6a9bb60c8" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">接下来还会遇到多次这类错误，如果不想一个一个点也可以点击 </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Maven Project </strong></span><span class="SemanticString">窗口上方的 </span><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">Generate Sources and Update Folders For All Projects</em></span><span class="SemanticString">，但不一定生效，取决于 maven 版本，较新版本的 maven 不会出现该问题，官方文档有解释说明：</span></span></p></div><blockquote id="https://www.notion.so/622081e6a10842f284436e9bffe2c5f5" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString">The version of Maven bundled with IntelliJ may not be new enough for Spark. If that happens, the action “Generate Sources and Update Folders For All Projects” could fail silently. Please remember to reset the Maven home directory (Preference -&gt; Build, Execution, Deployment -&gt; Maven -&gt; Maven home directory) of your project to point to a newer installation of Maven. You may also build Spark with the script build/mvn first. If the script cannot locate a new enough Maven installation, it will download and install a recent version of Maven to folder build/apache-maven-&lt;version&gt;/.</span></span></blockquote><div id="https://www.notion.so/733a6d126402410197b3889bf571459a" class="Divider"></div><h2 id="https://www.notion.so/71a0ecd0c3b94f24b96a59145f670be4" class="ColorfulBlock ColorfulBlock--BgRed Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/71a0ecd0c3b94f24b96a59145f670be4"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">4.</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">2 java.lang.NoClassDefFoundError: scala/Function1</strong></span></span></h2><div id="https://www.notion.so/cb75e2ad802a4864b0583c551777ee23" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">再次运行 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">LocalPi.scala</code></span><span class="SemanticString">，这次会出现以下错误：</span></span></p></div><pre id="https://www.notion.so/83b6a3204eab4b49a3d3fe58424bd110" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span> Exception in thread &quot;main&quot; java.lang.NoClassDefFoundError: scala/Function1
     at org.apache.spark.examples.LocalPi.main(LocalPi.scala)
 Caused by: java.lang.ClassNotFoundException: scala.Function1
     at java.net.URLClassLoader.findClass(URLClassLoader.java:381)
     at java.lang.ClassLoader.loadClass(ClassLoader.java:424)
     at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:349)
     at java.lang.ClassLoader.loadClass(ClassLoader.java:357)
     ... 1 more</span></span></span></code></pre><div id="https://www.notion.so/63cd7e756afe435b8130c6c93ec33d8f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">此处为Scala的sdk配置问题，选中sprak项目，</span><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">Ctrl+Alt+Shift+S</em></span><span class="SemanticString"> 打开项目对应的 </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Project Structure</strong></span><span class="SemanticString">，点击 </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Global Libraries</strong></span><span class="SemanticString">，如果看到已经配置了 scala-sdk，则将其删除，重新添加，并选择 module 生效范围，此处选择全部 module。</span></span></p></div><div id="https://www.notion.so/42f5bed6d21d4da9b619d8786497be77" class="Image Image--PageWidth"><figure><a href="https://raw.githubusercontent.com/Rianico/Image/master/ARTS_Tips/1567664376417.png"><img src="https://raw.githubusercontent.com/Rianico/Image/master/ARTS_Tips/1567664376417.png" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/08c90d9056d5415f85ce07cde6d57b64" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">再次运行，成功输出如下信息则代表配置生效：</span></span></p></div><pre id="https://www.notion.so/41428cf7dc954386bd9d03dc0c1669c0" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span> Pi is roughly <span class="token number">3.15404</span>
 ​
 Process finished with <span class="token builtin class-name">exit</span> code <span class="token number">0</span></span></span></span></code></pre><div id="https://www.notion.so/3923a9c8e707451abb50e927825d1f90" class="Divider"></div><h2 id="https://www.notion.so/c33b45bbc7ec4765b8e6c173bfa87886" class="ColorfulBlock ColorfulBlock--BgRed Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/c33b45bbc7ec4765b8e6c173bfa87886"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">4.</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">3 java.lang.NoClassDefFoundError: org/apache/spark/sql/SparkSession$</strong></span></span></h2><div id="https://www.notion.so/4fcccf4138024cd3b9aee744106c8c33" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">成功运行 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">LocalPi.scala</code></span><span class="SemanticString"> 后，开始运行 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">SparkPi.scala</code></span><span class="SemanticString">，首次运行会出现以下错误：</span></span></p></div><pre id="https://www.notion.so/26294903fb1a4e26aeba339e33ebb31c" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span> Exception in thread &quot;main&quot; java.lang.NoClassDefFoundError: org/apache/spark/sql/SparkSession$
     at org.apache.spark.examples.SparkPi$.main(SparkPi.scala:28)
     at org.apache.spark.examples.SparkPi.main(SparkPi.scala)
 Caused by: java.lang.ClassNotFoundException: org.apache.spark.sql.SparkSession$
     at java.net.URLClassLoader.findClass(URLClassLoader.java:381)
     at java.lang.ClassLoader.loadClass(ClassLoader.java:424)
     at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:349)
     at java.lang.ClassLoader.loadClass(ClassLoader.java:357)
     ... 2 more</span></span></span></code></pre><div id="https://www.notion.so/138329fde10149c2915b6d628a2a4509" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">由于 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">SparkPi.scala</code></span><span class="SemanticString"> 是属于 </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">spark-examples </strong></span><span class="SemanticString">模块的的，需要依赖 </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">spark-sql </strong></span><span class="SemanticString">模块运行，而在 </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">spark-examples </strong></span><span class="SemanticString">的 pom 文件中对 </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">spark-sql </strong></span><span class="SemanticString">的 scope 配置为 provided，因此需要对 </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">spark-example </strong></span><span class="SemanticString">的默认 run Configuration 进行修改。
选中 Idea 上的 </span><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">Run-&gt;Edit Configurations-&gt;Templates-&gt;Application</em></span><span class="SemanticString">，</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Use classpath of module </strong></span><span class="SemanticString">选择为 </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">spark-examples</strong></span><span class="SemanticString">，勾选 </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Include dependencies with &quot;Provided&quot; scope</strong></span><span class="SemanticString">，并编辑 </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">VM optiopns</strong></span><span class="SemanticString">，添加</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">-Dspark.master=local[2]</code></span><span class="SemanticString">参数，如图所示：</span></span></p></div><div id="https://www.notion.so/11dd836724ab47d3be9b184fb552cd45" class="Image Image--PageWidth"><figure><a href="https://raw.githubusercontent.com/Rianico/Image/master/ARTS_Tips/1567667267205.png"><img src="https://raw.githubusercontent.com/Rianico/Image/master/ARTS_Tips/1567667267205.png" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/44ef77dd2bdb4c58b107441ff5e05c0f" class="Divider"></div><h2 id="https://www.notion.so/cd72f3314d5f473e9ef77956d4c0e9dd" class="ColorfulBlock ColorfulBlock--BgRed Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/cd72f3314d5f473e9ef77956d4c0e9dd"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">4.</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">4 org.apache.spark.SparkException: Error while locating file spark-version-info.properties</strong></span></span></h2><div id="https://www.notion.so/0d6bdd0c5b7846938f93dedbe4cb2e30" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">再次运行 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">SparkPi.scala</code></span><span class="SemanticString"> ，抛出该错误，是因为 </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">spark-core </strong></span><span class="SemanticString">模块缺少了 </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="http://spark-version-info.properties"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">spark-version-info.properties</strong></a></span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"> </strong></span><span class="SemanticString">文件，这个文件需要我们去手动生成（具体原因不明，估计 maven 编译起来的效果还是不如 sbt 好，然而 sbt 国内网络环境又差）。</span></span></p></div><div id="https://www.notion.so/be3ef8a3782e4234ac9664854e5ba7be" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">接下来去到 Spark 的目录下，启动git bash，指定以下命令生成该文件：</span></span></p></div><pre id="https://www.notion.so/42ca32fd2cb44df9b816c4b4abc4efec" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span> <span class="token comment"># 2.1.0为对应Spark版本</span>
 build/spark-build-info core/target/extra-resources <span class="token number">2.1</span>.0</span></span></span></code></pre><div id="https://www.notion.so/a4a49005b8b64cef99fd109fe630721c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">然后 Idea 中选中 </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">spark-core </strong></span><span class="SemanticString">模块，选择 Idea 菜单上的
</span><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">Build-&gt;Rebuild Module spark-core</em></span><span class="SemanticString"> 重新进行构建，再次运行 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">SparkPi.scala</code></span><span class="SemanticString">，可以看到控制台开始输出Spark相关日志，大功告成！</span></span></p></div><pre id="https://www.notion.so/a3c9586d4c89446080430f2edac1a3c4" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span> ...
 19/09/05 15:20:32 INFO TaskSetManager: Finished task 0.0 in stage 0.0 (TID 0) in 146 ms on localhost (executor driver) (1/2)
 19/09/05 15:20:32 INFO TaskSetManager: Finished task 1.0 in stage 0.0 (TID 1) in 111 ms on localhost (executor driver) (2/2)
 19/09/05 15:20:32 INFO TaskSchedulerImpl: Removed TaskSet 0.0, whose tasks have all completed, from pool 
 19/09/05 15:20:32 INFO DAGScheduler: ResultStage 0 (reduce at SparkPi.scala:38) finished in 0.174 s
 19/09/05 15:20:32 INFO DAGScheduler: Job 0 finished: reduce at SparkPi.scala:38, took 0.426254 s
 Pi is roughly 3.1396556982784913
 19/09/05 15:20:32 INFO ServerConnector: Stopped Spark@401f7633{HTTP/1.1}{0.0.0.0:4041}
 ...</span></span></span></code></pre><div id="https://www.notion.so/b3dc0cfd482a40ae903b41ada06c7d8d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">以上就是本次的搭建过程，如果有什么问题，欢迎指出交流。</span></span></p></div></article>
  <footer class="Footer">
  <div>&copy; Rianico‘s Blog 2019-2021</div>
  <div>&centerdot;</div>
  <div>Powered by <a href="https://github.com/dragonman225/notablog" target="_blank"
      rel="noopener noreferrer">Notablog</a>.
  </div>
</footer>
</body>

</html>