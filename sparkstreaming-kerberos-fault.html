<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- iOS Safari -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <!-- Chrome, Firefox OS and Opera Status Bar Color -->
  <meta name="theme-color" content="#FFFFFF">
  <meta property="og:title" content="è®°ä¸€æ¬¡SparkStreamingä½œä¸šç”±äºKerberosè¿‡æœŸå¯¼è‡´å¡æ­»">
  
  <meta name="description" content="è®°ä¸€æ¬¡ cdh ç‰ˆæœ¬çš„ Spark + Kerberos çš„å‘ã€‚">
  <meta property="og:description" content="è®°ä¸€æ¬¡ cdh ç‰ˆæœ¬çš„ Spark + Kerberos çš„å‘ã€‚">
  
  <meta property="og:type" content="blog">
  <title>è®°ä¸€æ¬¡SparkStreamingä½œä¸šç”±äºKerberosè¿‡æœŸå¯¼è‡´å¡æ­»</title>
  <!-- Favicon -->
  
  <link rel="shortcut icon" href="https://avatars1.githubusercontent.com/u/32795735?s=400&u=40ed0595fb3044b01c47849f59ad96d69b4dc8db&v=4">
  
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
  <link rel="stylesheet" type="text/css"
    href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/themes/prism.min.css">
  <link rel="stylesheet" type="text/css" href="css/SourceSansPro.css">
  <link rel="stylesheet" type="text/css" href="css/notablog.css">
  <link rel="stylesheet" type="text/css" href="css/theme.css">
  <style>
    :root {
      font-size: 18px;
    }

    .DateTagBar {
      margin-top: 1.0rem;
    }
  </style>
</head>

<body>
  <nav class="Navbar">
    <a href="index.html">
      <div class="Navbar__Btn"><span><img class="inline-img-icon" src="https://avatars1.githubusercontent.com/u/32795735?s=400&u=40ed0595fb3044b01c47849f59ad96d69b4dc8db&v=4"></span> <span>Home</span></div>
    </a>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <span class="Navbar__Delim">&centerdot;</span>
    <a href="about.html">
      <div class="Navbar__Btn"><span>ğŸ˜€</span> <span>About</span></div>
    </a>
    
    
  </nav>
  <header class="Header">
      
    <div class="Header__Cover">
        <img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F7096c4d5-9d28-476c-81ba-9424fe327016%2Fphoto-1509910110001-4e756f86fbd3.jfif?table=block&id=f6452caf-807b-419d-a25b-c5db425ac470">
      </div>
      
    <div class="Header__Spacer ">
    </div>
    
    <div class="Header__Icon"><span><img class="inline-img-icon" src="https://raw.githubusercontent.com/Rianico/Image/master/Avator/sparkles%20(1).png"></span></div>
    
    <h1 class="Header__Title">è®°ä¸€æ¬¡SparkStreamingä½œä¸šç”±äºKerberosè¿‡æœŸå¯¼è‡´å¡æ­»</h1>
        
    <div class="DateTagBar">
          
      <span class="DateTagBar__Item DateTagBar__Date">Posted on Tue, Jun 1, 2021</span>
          
          
      <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--default">
            <a href="tag/Spark.html">Spark</a>
          </span>
          
      <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--default">
            <a href="tag/Kerberos.html">Kerberos</a>
          </span>
          
        </div>
        
  </header>
      <article id="https://www.notion.so/f6452caf807b419da25bc5db425ac470" class="PageRoot PageRoot--FullWidth"><ul id="https://www.notion.so/bf8964a5220d4d4e94caa4c6ed86c256" class="ColorfulBlock ColorfulBlock--ColorGray TableOfContents"><li class="TableOfContents__Item"><a href="#https://www.notion.so/72414079e6cf4e219512d437e8401953"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">1. </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">å‰è¨€</strong></span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/1686ae3933654be69e1a5968eb107d9a"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">2. </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">æ’æŸ¥è¿‡ç¨‹</strong></span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/2c6ad4254cc54a07a9c2c2fd88f5dabc"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">3. </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">å‡ºç°é—®é¢˜çš„åŸå› </strong></span></span></div></a></li></ul><h2 id="https://www.notion.so/72414079e6cf4e219512d437e8401953" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/72414079e6cf4e219512d437e8401953"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">1. </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">å‰è¨€</strong></span></span></h2><div id="https://www.notion.so/1770be6e900848ec99c2eb181dabc58c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">å…ˆè¯´ä¸‹ç»“è®ºï¼Œè¿™ä¸ªé—®é¢˜æ˜¯ç”±äº Spark </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">2.1.0.cloudera1</strong></span><span class="SemanticString"> ç‰ˆæœ¬çš„ bugï¼ˆå…¶ä»– cdh ç›¸å…³ç‰ˆæœ¬æœªéªŒè¯ï¼ŒåŸç”Ÿ 2.1 å¹¶æ²¡æœ‰è¿™ä¸ªé—®é¢˜ï¼‰ï¼Œå†åŠ ä¸Š Kerberos å‡­æ®è¿‡æœŸæ—¶é—´ç‚¹æ­£å¥½ä¸ checkpoint çš„æ—¶é—´ç‚¹é‡åˆå¯¼è‡´çš„ã€‚</span></span></p></div><h2 id="https://www.notion.so/1686ae3933654be69e1a5968eb107d9a" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/1686ae3933654be69e1a5968eb107d9a"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">2. </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">æ’æŸ¥è¿‡ç¨‹</strong></span></span></h2><div id="https://www.notion.so/7f1ec5fc8f564a97bc443ac02bca6cf7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">æŸ¥çœ‹ 5 æœˆ 29 å·å½“å¤© HDFS æ•°æ®ï¼Œå‘ç°åœ¨ 15:35 åˆ†åå°±æ²¡æœ‰æ•°æ®äº†ï¼š</span></span></p></div><div id="https://www.notion.so/4af75263dbfe48989512f5a95d351ed9" class="Image Image--Normal"><figure><a href="https://gitee.com/zhxuankun/Image/raw/master/Avator/image-20210601160601675.png?width=480"><img src="https://gitee.com/zhxuankun/Image/raw/master/Avator/image-20210601160601675.png?width=480" style="width:480px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/908eb31757c147908fa8724eb24571eb" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">æŸ¥çœ‹ä½œä¸š Driver ç«¯ï¼Œæ—¥å¿—å¦‚ä¸‹ï¼š</span></span></p></div><pre id="https://www.notion.so/1e0fb06341d54fec8bf3ef7a611234c4" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>Â 21/05/31 11:33:20 INFO JobScheduler: Added jobs for time 1622432000000 ms
Â 21/05/31 11:33:20 INFO JobGenerator: Checkpointing graph for time 1622432000000 ms
Â 21/05/31 11:33:20 INFO DStreamGraph: Updating checkpoint data for time 1622432000000 ms
Â 21/05/31 11:33:20 INFO DStreamGraph: Updated checkpoint data for time 1622432000000 ms
Â 21/05/31 11:33:20 INFO CheckpointWriter: Submitted checkpoint of time 1622432000000 ms to writer queue
Â 21/05/31 11:33:20 INFO CheckpointWriter: Saving checkpoint for time 1622432000000 ms to file &#x27;hdfs://nzj-cluster-gdyd/zkx_deploy/xdrhub_jiake/checkpoint/cyw/https/CY_HTTPS_JIAKE_GZ_XDR/all/checkpoint-1622432000000&#x27;
Â 21/05/31 11:33:20 WARN UserGroupInformation: PriviledgedActionException as:zkx (auth:SIMPLE) cause:org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.security.token.SecretManager$InvalidToken): token (token for zkx: HDFS_DELEGATION_TOKEN owner=zkx, renewer=yarn, realUser=oozie/service2.nzj.gdyd@NZJ.GDYD, issueDate=1619681808569, maxDate=1622273808569, sequenceNumber=370742481, masterKeyId=803) can&#x27;t be found in cache
Â 21/05/31 11:33:20 WARN Client: Exception encountered while connecting to the server : org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.security.token.SecretManager$InvalidToken): token (token for zkx: HDFS_DELEGATION_TOKEN owner=zkx, renewer=yarn, realUser=oozie/service2.nzj.gdyd@NZJ.GDYD, issueDate=1619681808569, maxDate=1622273808569, sequenceNumber=370742481, masterKeyId=803) can&#x27;t be found in cache
Â 21/05/31 11:33:20 WARN UserGroupInformation: PriviledgedActionException as:zkx (auth:SIMPLE) cause:org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.security.token.SecretManager$InvalidToken): token (token for zkx: HDFS_DELEGATION_TOKEN owner=zkx, renewer=yarn, realUser=oozie/service2.nzj.gdyd@NZJ.GDYD, issueDate=1619681808569, maxDate=1622273808569, sequenceNumber=370742481, masterKeyId=803) can&#x27;t be found in cache
Â 21/05/31 11:33:20 WARN CheckpointWriter: Error in attempt 1 of writing checkpoint to &#x27;hdfs://nzj-cluster-gdyd/zkx_deploy/xdrhub_jiake/checkpoint/cyw/https/CY_HTTPS_JIAKE_GZ_XDR/all/checkpoint-1622432000000&#x27;
Â org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.security.token.SecretManager$InvalidToken): token (token for zkx: HDFS_DELEGATION_TOKEN owner=zkx, renewer=yarn, realUser=oozie/service2.nzj.gdyd@NZJ.GDYD, issueDate=1619681808569, maxDate=1622273808569, sequenceNumber=370742481, masterKeyId=803) can&#x27;t be found in cache
Â     at org.apache.hadoop.ipc.Client.call(Client.java:1504)
Â     at org.apache.hadoop.ipc.Client.call(Client.java:1441)
Â     at org.apache.hadoop.ipc.ProtobufRpcEngine$Invoker.invoke(ProtobufRpcEngine.java:230)
Â     at com.sun.proxy.$Proxy10.delete(Unknown Source)
Â     at org.apache.hadoop.hdfs.protocolPB.ClientNamenodeProtocolTranslatorPB.delete(ClientNamenodeProtocolTranslatorPB.java:535)
Â     at sun.reflect.GeneratedMethodAccessor81.invoke(Unknown Source)
Â     at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
Â     at java.lang.reflect.Method.invoke(Method.java:498)
Â     at org.apache.hadoop.io.retry.RetryInvocationHandler.invokeMethod(RetryInvocationHandler.java:260)
Â     at org.apache.hadoop.io.retry.RetryInvocationHandler.invoke(RetryInvocationHandler.java:104)
Â     at com.sun.proxy.$Proxy11.delete(Unknown Source)
Â     at org.apache.hadoop.hdfs.DFSClient.delete(DFSClient.java:2062)
Â     at org.apache.hadoop.hdfs.DistributedFileSystem$13.doCall(DistributedFileSystem.java:684)
Â     at org.apache.hadoop.hdfs.DistributedFileSystem$13.doCall(DistributedFileSystem.java:680)
Â     at org.apache.hadoop.fs.FileSystemLinkResolver.resolve(FileSystemLinkResolver.java:81)
Â     at org.apache.hadoop.hdfs.DistributedFileSystem.delete(DistributedFileSystem.java:680)
Â     at org.apache.spark.streaming.CheckpointWriter$CheckpointWriteHandler.run(Checkpoint.scala:233)
Â     at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
Â     at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
Â     at java.lang.Thread.run(Thread.java:748)
Â 21/05/31 11:33:20 INFO CheckpointWriter: Saving checkpoint for time 1622432000000 ms to file &#x27;hdfs://nzj-cluster-gdyd/zkx_deploy/xdrhub_jiake/checkpoint/cyw/https/CY_HTTPS_JIAKE_GZ_XDR/all/checkpoint-1622432000000&#x27;
Â Exception in thread &quot;pool-20-thread-1582&quot; java.lang.NullPointerException
Â     at org.apache.spark.streaming.CheckpointWriter$CheckpointWriteHandler.run(Checkpoint.scala:233)
Â     at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
Â     at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
Â     at java.lang.Thread.run(Thread.java:748)</span></span></span></code></pre><div id="https://www.notion.so/f3c3143d88294df7a2d5440444de6d54" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">å¯ä»¥çœ‹åˆ°ï¼ŒDriver å¹¶æœªæŒ‚æ‰ï¼Œè€Œæ˜¯æŒç»­æŠ›å‡ºå¼‚å¸¸ï¼Œé‡ç‚¹å…³æ³¨ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.security.token.SecretManager$InvalidToken): token (token for zkx: HDFS_DELEGATION_TOKEN owner=zkx, renewer=yarn, realUser=oozie/service2.nzj.gdyd@NZJ.GDYD, issueDate=1619681808569, maxDate=1622273808569, sequenceNumber=370742481, masterKeyId=803) can&#x27;t be found</code></span><span class="SemanticString"> è¿™å¥ï¼Œå…¶ä¸­  </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">maxDate=1622273808569</code></span><span class="SemanticString"> å¯¹åº”æ—¶é—´ç‚¹ä¸º </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">2021-05-29 15:36:48</code></span><span class="SemanticString">ï¼Œæ­£å¥½åœ¨æ•°æ®ä¸­æ–­åçš„ç¬¬ä¸€ä¸ª batch é‡Œï¼Œæ¥ç€åé¢åˆæŠ›å‡ºäº†ä¸€ä¸ªç©ºå¼‚å¸¸ï¼š</span></span></p></div><pre id="https://www.notion.so/83034b9325a94d1986137f9052929d73" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>Â Exception in thread &quot;pool-20-thread-1582&quot; java.lang.NullPointerException
Â     at org.apache.spark.streaming.CheckpointWriter$CheckpointWriteHandler.run(Checkpoint.scala:233)
Â ...</span></span></span></code></pre><div id="https://www.notion.so/79bf14d2d20c459e9c807befb81d0cfa" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">ä»ç©ºå¼‚å¸¸çš„ç›¸å…³æ—¥å¿—ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œè¯¥ç©ºå¼‚å¸¸æ˜¯ä»åœ¨ä¸€ä¸ªçº¿ç¨‹æ± é‡Œæ‰§è¡Œçš„ï¼Œå†ç»“åˆ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">pool-20-thread-1582</code></span><span class="SemanticString"> çš„çº¿ç¨‹ ID å¯ä»¥æ¨å¯¼å‡ºï¼Œåœ¨æ¯æ¬¡æŠ›å‡ºç©ºå¼‚å¸¸åï¼ŒSpark å¹¶æ²¡æœ‰å¯¹è¯¥å¼‚å¸¸åšä»»ä½•å¤„ç†ï¼Œè€Œæ˜¯ç®€å•çš„è®©çº¿ç¨‹æŒ‚æ‰å¹¶æ–°å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰€ä»¥æ‰èƒ½çœ‹åˆ°è¿™ä¹ˆå¤§çš„çº¿ç¨‹ IDã€‚</span></span></p></div><div id="https://www.notion.so/4907b8eb312148c1963ad5267215c00a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">æ ¹æ®ç©ºå¼‚å¸¸çš„æç¤ºï¼ŒæŸ¥çœ‹ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Checkpoint.scala:233</code></span><span class="SemanticString"> å¤„çš„ Spark æºç ï¼ˆç‰ˆæœ¬ </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">2.1.0.cloudera1</strong></span><span class="SemanticString">ï¼‰ï¼š</span></span></p></div><pre id="https://www.notion.so/b6d152e1c3a04e0688926230ac90cbd8" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>Â     def run() {
Â       if (latestCheckpointTime == null || latestCheckpointTime &lt; checkpointTime) {
Â         latestCheckpointTime = checkpointTime
Â       }
Â       if (fs == null) {
Â         fs = new Path(checkpointDir).getFileSystem(hadoopConf)
Â       }
Â       var attempts = 0
Â       val startTime = System.currentTimeMillis()
Â       val tempFile = new Path(checkpointDir, &quot;temp&quot;)
Â       // We will do checkpoint when generating a batch and completing a batch. When the processing
Â       // time of a batch is greater than the batch interval, checkpointing for completing an old
Â       // batch may run after checkpointing of a new batch. If this happens, checkpoint of an old
Â       // batch actually has the latest information, so we want to recovery from it. Therefore, we
Â       // also use the latest checkpoint time as the file name, so that we can recover from the
Â       // latest checkpoint file.
Â       //
Â       // Note: there is only one thread writing the checkpoint files, so we don&#x27;t need to worry
Â       // about thread-safety.
Â       val checkpointFile = Checkpoint.checkpointFile(checkpointDir, latestCheckpointTime)
Â       val backupFile = Checkpoint.checkpointBackupFile(checkpointDir, latestCheckpointTime)
Â 
Â       while (attempts &lt; MAX_ATTEMPTS &amp;&amp; !stopped) {
Â         attempts += 1
Â         try {
Â           logInfo(s&quot;Saving checkpoint for time $checkpointTime to file &#x27;$checkpointFile&#x27;&quot;)
Â 
Â           // Write checkpoint to temp file
Â           fs.delete(tempFile, true) // just in case it exists
Â           val fos = fs.create(tempFile)
Â           Utils.tryWithSafeFinally {
Â             fos.write(bytes)
Â           } {
Â             fos.close()
Â           }
Â 
Â           // If the checkpoint file exists, back it up
Â           // If the backup exists as well, just delete it, otherwise rename will fail
Â           if (fs.exists(checkpointFile)) {
Â             fs.delete(backupFile, true) // just in case it exists
Â             if (!fs.rename(checkpointFile, backupFile)) {
Â               logWarning(s&quot;Could not rename $checkpointFile to $backupFile&quot;)
Â             }
Â           }
Â 
Â           // Rename temp file to the final checkpoint file
Â           if (!fs.rename(tempFile, checkpointFile)) {
Â             logWarning(s&quot;Could not rename $tempFile to $checkpointFile&quot;)
Â           }
Â 
Â           // Delete old checkpoint files
Â           val allCheckpointFiles = Checkpoint.getCheckpointFiles(checkpointDir, Some(fs))
Â           if (allCheckpointFiles.size &gt; 10) {
Â             allCheckpointFiles.take(allCheckpointFiles.size - 10).foreach { file =&gt;
Â               logInfo(s&quot;Deleting $file&quot;)
Â               fs.delete(file, true)
Â             }
Â           }
Â 
Â           // All done, print success
Â           val finishTime = System.currentTimeMillis()
Â           logInfo(s&quot;Checkpoint for time $checkpointTime saved to file &#x27;$checkpointFile&#x27;&quot; +
Â             s&quot;, took ${bytes.length} bytes and ${finishTime - startTime} ms&quot;)
Â           jobGenerator.onCheckpointCompletion(checkpointTime, clearCheckpointDataLater)
Â           return
Â         } catch {
Â           case ioe: IOException =&gt;
Â             val msg = s&quot;Error in attempt $attempts of writing checkpoint to &#x27;$checkpointFile&#x27;&quot;
Â             logWarning(msg, ioe)
Â             fs = null
Â         }
Â       }
Â       logWarning(s&quot;Could not write checkpoint for time $checkpointTime to file &#x27;$checkpointFile&#x27;&quot;)
Â     }
Â   }</span></span></span></code></pre><div id="https://www.notion.so/203c0b73579442adb422a82f649ea603" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">å¯ä»¥çœ‹åˆ°ï¼Œrun æ–¹æ³•ä¸­ä¸»è¦æ˜¯ä¸€ä¸ªæœ‰é™æ¬¡æ•°çš„å¾ªç¯ï¼Œç»“åˆæ—¥å¿— </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Error in attempt 1 of writing checkpoint to...</code></span><span class="SemanticString"> å¯ä»¥çœ‹åˆ°ç¬¬ä¸€æ¬¡å¾ªç¯æ•è·å¼‚å¸¸åä¼šæŠŠ fs è®¾ç½®ä¸º nullï¼Œè¿›å…¥ç¬¬äºŒè½®å¾ªç¯ï¼Œè€Œç©ºå¼‚å¸¸æ­£å¥½æ˜¯åœ¨ </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">fs.delete(tempFile, true) // just in case it exists</code></span><span class="SemanticString"> å¤„æŠ›å‡ºçš„ï¼Œè€Œ run æ–¹æ³•ä¸­æ²¡æœ‰å¯¹ç©ºå¼‚å¸¸è¿›è¡Œæ•è·ï¼Œå¯¼è‡´çº¿ç¨‹ç›´æ¥æŒ‚æ‰ã€‚åŒæ—¶ Spark ä¹Ÿæ— æ³•æ„ŸçŸ¥åˆ°ä»»ä½•å¼‚å¸¸çš„å‘ç”Ÿã€‚</span></span></p></div><div id="https://www.notion.so/2b421472657e42709b5703840f02208e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">æŸ¥çœ‹åŸç”Ÿ Spark 2.1 ç›¸åŒå¤„çš„æºç ï¼Œå‘ç° fs æœ‰å¯¹ null è¿›è¡Œäº†å¤„ç†ï¼š</span></span></p></div><pre id="https://www.notion.so/9b57d8b82ec6403a96aae15acdbde2e3" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>Â           logInfo(s&quot;Saving checkpoint for time $checkpointTime to file &#x27;$checkpointFile&#x27;&quot;)
Â           if (fs == null) {
Â             fs = new Path(checkpointDir).getFileSystem(hadoopConf)
Â           }</span></span></span></code></pre><div id="https://www.notion.so/5845f6f4f3af458da2e6a5f34ecbd6d3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">ä¹Ÿå°±æ˜¯è¯´ï¼Œèµ·ç ä» Spark 2.1 å¼€å§‹ï¼Œä¸å­˜åœ¨è¯¥é—®é¢˜ã€‚</span></span></p></div><h2 id="https://www.notion.so/2c6ad4254cc54a07a9c2c2fd88f5dabc" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/2c6ad4254cc54a07a9c2c2fd88f5dabc"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">3. </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">å‡ºç°é—®é¢˜çš„åŸå› </strong></span></span></h2><div id="https://www.notion.so/bd098c081b3b4372a91714ec113f691c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">ä»æ—¥å¿—æ¥çœ‹ï¼Œå½“ Kerberos è¿‡æœŸï¼Œè€Œ Spark Driver ç«¯åˆæ­£å¥½åœ¨å†™ checkpoint çš„æ—¶å€™ï¼Œå°±ä¼šå‡ºç°ä»¥ä¸Šå¼‚å¸¸ã€‚</span></span></p></div><div id="https://www.notion.so/c619350f2edb4ffda7f31bc1b144e93f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Kerberos çš„æœ‰æ•ˆé—´éš”ä¸º 30 å¤©æ•´ï¼Œä¸€æ—¦æˆ‘ä»¬å¯åŠ¨ Spark ä½œä¸šçš„æ—¶é—´ç‚¹æ­£å¥½æ’ä¸Š checkpoint æ—¶é—´ç‚¹ï¼Œå°±ä¼šé‡å¤å‡ºç°è¿™ä¸ªé—®é¢˜ï¼Œä½†æ¦‚ç‡è¾ƒå°ï¼Œå…·æœ‰éšæœºæ€§ã€‚</span></span></p></div><div id="https://www.notion.so/49f87944e4e14bf1a9959b7fab00fd7c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">ç”±äºè¿‘æœŸä¸ºäº†æé«˜èµ„æºåˆ©ç”¨ç‡ç¼©çŸ­äº† batch é—´éš”ï¼Œæ‰€ä»¥ä»¥ä¸Šé—®é¢˜å‘ç”Ÿçš„æ¦‚ç‡å¢åŠ äº†ï¼Œè™½ç„¶æ¦‚ç‡ä»ç„¶å¾ˆå°ï¼Œä½†éšç€å¤„ç†é—´éš”è¶ŠçŸ­ï¼Œå‘ç”Ÿè¯¥é—®é¢˜çš„æ¦‚ç‡è¶Šé«˜ã€‚</span></span></p></div><div id="https://www.notion.so/45512200ade54f4581bc2d0b8a4860e5" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">å¯ä»¥è€ƒè™‘é€šè¿‡å‡çº§ Spark ç‰ˆæœ¬çš„æ–¹å¼æ¥å½»åº•è§£å†³è¯¥é—®é¢˜ã€‚</span></span></p></div></article>
  <footer class="Footer">
        <div>&copy; Rianicoâ€˜s Blog 2019</div>
        <div>&centerdot;</div>
        <div>Powered by <a href="https://github.com/dragonman225/notablog" target="_blank"
            rel="noopener noreferrer">Notablog</a>.
        </div>
    </footer>
</body>

</html>